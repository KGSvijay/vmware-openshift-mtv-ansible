    - name: Gather VM information
      community.vmware.vmware_vm_info:
        hostname: "{{ vcenter_host }}"
        username: "{{ vcenter_user }}"
        password: "{{ vcenter_password }}"
        vm_name: "{{ vm_name }}"
      delegate_to: localhost
      register: vm_info

    - name: Extract datastore information
      set_fact:
        datastores: "{{ item.datastore | map(attribute='name') | list }}"
      loop: "{{ vm_info.vms }}"
      when: item.name == vm_name

    - name: Display datastore information
      debug:
        msg: "VM '{{ vm_name }}' is using the following datastores: {{ datastores | join(', ') }}"
